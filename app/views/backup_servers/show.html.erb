<% content_for :header do %>
  <%= @backup_server.hostname %>
<% end %>

<table class="index sortable">
<thead>
  <tr>
    <td>Zpool</td>
    <td>Max concurrent backups</td>
    <td>Disk free</td>
    <td>Number of servers</td>
    <td>Running backups</td>
  </tr>
</thead>
<tbody>
<tr>
  <td><%=h @backup_server.zpool %></td>
  <td><%=h @backup_server.max_backups %></td>
  <td><%=number_to_human_size @backup_server.disk_free %></td>
  <td><%=h @backup_server.servers.size %></td>
  <td><%=h @backup_server.running_backups.size %></td>
</tr>
</tbody>
</table>

<% if @backup_server.backup_jobs.size > 0 %>
  <hr/>
<h3>Latest backup jobs</h3>
<table class="index sortable">
  <thead>
  <tr>
	<th>Job</th>
    <th>Server</th>
    <th>Status</th>
    <th>Started</th>
    <th>Duration (from the moment of queueing)</th>
  </tr>
  </thead>
  <tbody>
<% @backup_server.latest_jobs.each do | job | %>
  <tr>
	<td><%= link_to job.id, job %></td>
    <td><%=link_to h(job.server.hostname), job.server %></td>
    <td><%=h job.display_status %></td>
    <td><%=h (job.started || job.updated_at) %></td>
    <td><%= distance_of_time_in_words((job.started || job.updated_at), job.updated_at )%>
  </tr>
  </tbody>
<% end %>
</table>
<% end %>

<% if @backup_server.problems.size > 0 %>
  <hr/>

<h3>Latest problems</h3>
<table class="index sortable">
<thead>
<tr>
  <th>Server</th>
  <th>When</th>
  <th>Message</th>
</tr>
</thead>
<tbody>
<% @backup_server.latest_problems.each do | problem | %>
  <tr>
    <td><%=h problem.server %></td>
    <td><%= problem.created_at %></td>
    <td><%=h problem.message %></td>
  </tr>
<% end %>
</tbody>
</table>
<% end %>
<% add_action 'Edit this backup server', edit_backup_server_path(@backup_server) %>
<% add_action 'Backup server overview', backup_servers_path %>