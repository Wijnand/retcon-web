<% if !@server.backup_server and !@server.new_record? %>
  <p style="color: red">Please select one or more backup profiles and a backup server below.</p>
<% end %>

<% semantic_form_for(@server) do |f| %>
  <% f.inputs do %>
    <% f.inputs :name => "General", :class => 'separator' do %>
      <%= f.input :hostname %>
      <%= f.input :enabled, :required => false, :label => 'Backups enabled?' %>
      <%= f.input :connect_to, :required => false, :label => 'Ssh address', :hint => 'If different from hostname' %>
      <%= f.input :ssh_port, :required => true, :hint => 'Probably port 22' %>
    <% end %>
    <% f.inputs :name => "Backup config", :class => 'separator' do %>
      <%= f.input :interval_hours, :required => true %>
      <%= f.input :keep_snapshots, :required => true, :label => 'Keep this number of snapshots' %>
      <%= f.input :window_start, :required => false, :hint => 'Integer 0-23. Window starts at 0:00 when empty.' %>
      <%= f.input :window_stop, :required => false, :hint => 'Integer 0-23. Window ends at 23:59 when empty.' %>
      <%= f.input :profiles, :as => :check_boxes, :required => false %><br/>
      <% unless @server.new_record? %>
        <%= f.input :backup_server, :hint => "You should probably select a backup server that is marked within the same subnet", 
                                    :collection => @server.possible_backup_servers,
                                    :label_method => Proc.new { |a| a.in_subnet ? a.hostname + " (within subnet)" : a.hostname },
                                    :include_blank => (@server.backup_server.nil? ? true : false )%>
                                    <p>When moving to another backup server the backup data will currently not be moved!</p>
      <% else %>
        <p>You can only select a backup server here when you save this record to the database first</p>
      <% end %>
    <% end %>
  <% end %>
  <%= f.buttons %>
<% end %>
